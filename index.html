<script>
    const API_KEY = "AIzaSyBbYV7unzd9anXu6HQ0udCqWRCtaNXacz8"; 

    async function askGemini() {
        const noun = document.getElementById('nounIn').value;
        const resultDiv = document.getElementById('auditResult');
        const loader = document.getElementById('loading');
        
        if(!noun) return;
        loader.style.display = 'block';
        resultDiv.style.display = 'none';

        const prompt = `Refactor the noun "${noun}" using the Quranic Root method. Format as: THE NOUN, THE QURANIC ROOT, THE LOGIC, THE METHOD, THE LEGACY.`;

        try {
            // 2026 Standard URL
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent`;
            
            const response = await fetch(url, {
                method: 'POST',
                headers: { 
                    'Content-Type': 'application/json',
                    'x-goog-api-key': API_KEY.trim() // THE 2026 SECURITY HEADER
                },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });

            const data = await response.json();
            
            if (data.error) {
                // This will show the EXACT reason (e.g., "Region not supported")
                throw new Error(data.error.message);
            }

            resultDiv.innerText = data.candidates[0].content.parts[0].text;
            resultDiv.style.display = 'block';
        } catch (e) {
            resultDiv.innerText = "SYSTEM ERROR: " + e.message;
            resultDiv.style.display = 'block';
        } finally {
            loader.style.display = 'none';
        }
    }
</script>
